# TCP/IP 소켓 프로그래밍

> 윤성우의 열혈 TCP/IP 소켓 프로그래밍 강의를 보고 작성한 것입니다.

## Chapter 01. 네트워크 프로그래밍과 소켓의 이해

##  네트워크 프로그래밍과 소켓의 이해

#### 네트워크 프로그래밍이란?

- **소켓**이라는 것을 기반으로 프로그래밍을 하기 때문에 소켓 프로그래밍이라고도 한다.
- 네트워크로 연결된 둘 이상의 컴퓨터 사이에서의 데이터 송수신 프로그램의 작성을 의미한다.

#### 소켓에 대한 간단한 이해

- 네트워크(인터넷)의 연결 도구
- 운영체제에 의해 제공이 되는 **소프트웨어적**인 장치
- 소켓은 프로그래머에게 데이터 송수신에 대한 물리적, 소프트웨어적 세세한 내용을 신경 쓰지 않게 한다.

네트워크 프로그래밍이라는 것은 두 개의 컴퓨터, 보통 호스트라고 표현을 하는데 데이터를 주고 받는 방법을 말한다. 데이터를 주고 받는 방법에 있어서 아무것도 없는 상태에서 이것을 완성하는 것에는 무리가 있다. 그렇기에 운영체제에서 소켓이란 것을 제공한다. 

소켓이라는 것은 표준에 의해서 개발 된 하나의 소프트웨어 모듈로 보면 된다. 소켓은 네트워크(인터넷)상에서 두 개의 소켓이 서로 연결이 가능하고 데이터를 주고 받을 수 있는 하나의 소프트웨어적인 도구이다. 

전력망으로부터 전기를 공급받기 위해 소켓을 꽂는 것과 마찬가지로 컴퓨터와 데이터를 송수신하려면 인터넷이라는 네트워크 망을 연결해야 하는데 이때 프로그래밍에서 '소켓'은 네트워크 망의 연결에 사용되는 도구이다. 즉, 연결이라는 의미가 담겨있어서 '소켓'이라는 표현을 사용한다.

### 전화 받는 소켓의 생성

#### 소켓의 비유와 분류

- TCP 소켓은 전화기에 비유될 수 있다.
  - 전화기를 생각해보면 전화망에 접속을 해서 상대 전화기에 연결을 요청하는데 즉, 전화망에 연결하는 일종의 도구가 되는 것이다.
- 소켓은 soket 함수의 호출을 통해서 생성한다.
  - 소켓을 실제로 생성해서 관리하는 것은 운영체제이고 함수 호출을 통해서 운영체제가 그에 적절한 조치를 소켓을 기반으로 해서 진행한다.
- 단, 전화를 거는 용도의 소켓과 전화를 수신하는 용도의 소켓 생성 방법에는 차이가 있다.

**[소켓의 생성]**

```c
#include <sys/socket.h>
int soket(int domain, int type, int protocol);
//->성공 시 파일 디스크립터, 실패 시 -1 반환
```

### 전화번호의 부여

#### 소켓의 주소 할당 및 연결

- 전화기에 전화번호가 부여되듯이 소켓에도 주소정보가 할당된다.
- 소켓의 주소정보는 IP와 PORT번호로 구성이 된다.

**[주소의 할당]**

```c
#include <sys/socket.h>
int bind(int sockfd, struct sockaddr *myaddr, socklen_t addrlen);
//-> 성공 시 0, 실패 시 -1 반환
```

### 전화기의 연결

#### 연결요청이 가능한 상태의 소켓

- 연결요청이 가능한 상태의 소켓은 걸려오는 전화를 받을 수 있는 상태에 비유할 수 있다.
- 전화를 거는 용도의 소켓은 연결요청이 가능한 상태의 소켓이 될 필요가 없다. 이는 걸려오는 전화를 받는 용도의 소켓에서 필요한 상태이다.

**[연결요청 가능한 상태로 변경]**

```c
#include<sys/socket.h>
int listen(int socketfd, int backlog);
// -> 성공 시 0 , 실패시 -1 반환
```

소켓에 할당된 IP와 PORT번호로 연결요청이 가능한 상태가 된다.

### 수화기를 드는 상황

#### 연결요청의 수락

- 걸려오는 전화에 대해서 수락의 의미로 수화기를 드는 것에 비유할 수 있다.
- 연결요청이 수락되어야 데이터의 송수신이 가능하다.
- 수락된 이후에 데이터의 송수신은 양방향으로 가능하다

**[연결요청 가능한 상태로 변경]**

```c
#include <sys/socket.h>
int accept(int sockfd, struct sockaddr *addr, socklen_t *adrlen);
// 성고 시 파일 디스크립터, 실패 시 -1 반환
```

accept 함수호출 이후에는 데이터의 송수신이 가능하다. 단, 연결요청이 있을 때에만 accept 함수가 반환을 한다.

------

### 정리

#### 연결요청을 허용하는 소켓의 생성과정

- 1단계. 소켓의 생성(socket 함수호출)
- 2단계. IP와 PORT번호의 할당(bind 함수호출)
- 3단계. 연결요청 가능상태로 변경(listen 함수호출)
- 4단계. 연결요청에 대한 수락(accept 함수호출)

#### 예제 hello_server.c를 통해서 함수의 호출과정 확인하기

- 연결요청을 허용하는 프로그램을 가리켜 일반적으로 서버(Server)라 한다.
- 서버는 연결을 요청하는 클라이언트보다 먼저 실행되어야 한다.
- 클라이언트보다 복잡한 실행의 과정을 거친다.

**이렇게 생성된 소켓을 가리켜 서버 소켓 또는 리스닝 소켓이라 한다.**

------

### 윈도우에서 리눅스 개발 환경 설정(WSL 설치 및 VS Code 연동)

#### 설치

1. Windows 10 607 버전 이상이 필요하며 [제어판]->[프로그램]->프로그램 및 기능 아래에 Windows 기능 켜기/끄기] -> [Linux용 Windows 하위 시스템] 체크 또는 PowerShell을 관리자 권하느로 열고 아래의 명령을 실행한다. 후에 컴퓨터를 재시작 한다.

```
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux
```

2. Microsoft Store에서 Ubuntu를 설치한다.
   1.  terminal을 설치한다.(추가적)
3. 설치가 완료 되면 실행을 한다. Ubuntu를 실행하거나 명령 프롬프트에서 wsl을 입력한다. 

#### Visual Studio Code와 WSL 연동

- WSL : 리눅스용 윈도우즈 서브 시스템

1. Visual Studio Code를 windows에 설치한다.
2. Visual Studio Code를 실행하여 Remote Development 확장 프로그램을 추가 설치한다.
3. 윈도우 측의 Git에서 소스코드의 line ending을 윈도우즈 형식으로 변경하지 못하도록 설정한다. 윈도우 프롬프트에서 git config --global core.autocrlf input 명령을 입력한다.

#### WSL의 폴더 열기

WSL 내부의 폴더를 VSCode를 이용하여 여는 방법

1. 시작 메뉴나 명령어 프롬프트에서 wsl을 입력해 WSL 터미널 창을 ㅇㄴ다.
2. 터미널을 열고 열고자 하는 폴더로 이동하여 (cd ~ 명령어를 사용) code .를 입력한다.
3. 진행이 완료된 후, VSCode 창이 나오며 하단에서 WSL 표시를 볼 수 있다.

> 관련 블로그
>
> [YJcode](https://yjcode.tistory.com/1?category=811393)
>
> *위 블로그에서 키 설정 내용은 [dev_(by may)](https://blog.naver.com/PostView.nhn?blogId=rorean&logNo=221346968488&parentCategoryNo=&categoryNo=8&viewDate=&isShowPopularPosts=true&from=search) 확인
>
> [학습기록 (by 쓴웃음)](https://rottk.tistory.com/entry/%EB%A6%AC%EB%88%85%EC%8A%A4-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EA%B0%9C%EB%B0%9C%EC%9D%84-%EC%9C%84%ED%95%9C-WSL-%EC%84%A4%EC%B9%98-%EB%B0%8F-VS-Code-%EC%97%B0%EB%8F%99)
>
> [sxin2949.lg (by sxin2949)](https://velog.io/@sxin2949/%EC%9C%88%EB%8F%84%EC%9A%B0%EC%97%90%EC%84%9C-%EB%A6%AC%EB%88%85%EC%8A%A4-%EA%B0%9C%EB%B0%9C-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0)

